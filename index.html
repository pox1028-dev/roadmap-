<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>百家樂 大路 + 下三路 Demo</title>
  <style>
    body {
      background:#0f172a;
      color:#f1f5f9;
      font-family: "Microsoft JhengHei", sans-serif;
      text-align:center;
      margin:20px;
    }
    h2 { margin-bottom:10px; }
    h3 { margin-top:30px; margin-bottom:10px; }
    .btns { margin-bottom:20px; }
    button {
      margin:5px; padding:10px 20px;
      font-size:16px; border:none;
      border-radius:6px; cursor:pointer;
      color:#fff;
    }
    button.banker { background:#dc2626; } /* 莊-紅 */
    button.player { background:#2563eb; } /* 閒-藍 */
    button.tie { background:#16a34a; }    /* 和-綠 */
    button.clear { background:#64748b; }  /* 清除-灰 */
    .board {
      background:#1e293b;
      border-radius:8px;
      padding:15px;
      margin:0 auto 20px auto;
      width:max-content;
      box-shadow:0 0 10px rgba(0,0,0,0.5);
    }
    .road {
      display:grid;
      grid-template-columns:repeat(30,22px);
      grid-auto-rows:22px;
      gap:2px;
      justify-content:center;
    }
    .cell {
      width:22px; height:22px;
      border:1px solid #334155;
      border-radius:50%;
    }
    .red { background:#dc2626; }
    .blue { background:#2563eb; }
    .green { background:#16a34a; }
  </style>
</head>
<body>
  <h2>百家樂 大路 + 下三路</h2>
  <div class="btns">
    <button class="banker" onclick="addResult('B')">莊</button>
    <button class="player" onclick="addResult('P')">閒</button>
    <button class="tie" onclick="addResult('T')">和</button>
    <button class="clear" onclick="clearAll()">清除全部</button>
  </div>

  <div class="board">
    <h3>大路</h3>
    <div id="mainRoad" class="road"></div>
  </div>

  <div class="board">
    <h3>大眼仔路</h3>
    <div id="bigEye" class="road"></div>
  </div>

  <div class="board">
    <h3>小路</h3>
    <div id="smallRoad" class="road"></div>
  </div>

  <div class="board">
    <h3>蟑螂路</h3>
    <div id="cockroach" class="road"></div>
  </div>

<script>
let results = [];
const MAX_ROWS = 6;

function addResult(r){
  results.push(r);
  drawRoads();
}

function clearAll(){
  results = [];
  drawRoads();
}

function drawRoads(){
  drawMainRoad();
  drawDerivedRoad("bigEye", 2);
  drawDerivedRoad("smallRoad", 3);
  drawDerivedRoad("cockroach", 4);
}

function drawMainRoad(){
  let div = document.getElementById("mainRoad");
  div.innerHTML = "";

  let cols = [];
  let col = [];
  let last = null;
  results.forEach(r=>{
    if(r===last || r==="T"){
      if(col.length < MAX_ROWS){
        col.push(r);
      } else {
        cols.push(col);
        col = [r];
      }
    } else {
      if(col.length) cols.push(col);
      col = [r];
    }
    last = r==="T" ? last : r;
  });
  if(col.length) cols.push(col);

  let grid = Array.from({length:MAX_ROWS},()=>Array(30).fill(""));
  cols.forEach((c, ci)=>{
    c.forEach((r, ri)=>{
      grid[ri][ci] = r;
    });
  });

  grid.forEach(row=>{
    row.forEach(r=>{
      let cell = document.createElement("div");
      cell.className = "cell";
      if(r==="B") cell.classList.add("red");
      if(r==="P") cell.classList.add("blue");
      if(r==="T") cell.classList.add("green");
      div.appendChild(cell);
    });
  });
}

function drawDerivedRoad(id, startRow){
  let div = document.getElementById(id);
  div.innerHTML = "";

  let cols = [];
  let col = [];
  let last = null;
  results.forEach(r=>{
    if(r===last || r==="T"){
      if(col.length < MAX_ROWS){
        col.push(r);
      } else {
        cols.push(col);
        col = [r];
      }
    } else {
      if(col.length) cols.push(col);
      col = [r];
    }
    last = r==="T" ? last : r;
  });
  if(col.length) cols.push(col);

  let derived = [];
  for(let c=1;c<cols.length;c++){
    let currCol = cols[c];
    for(let r=startRow-1;r<currCol.length;r++){
      let color = checkSymmetry(cols, c, r);
      derived.push(color);
    }
  }

  derived.forEach(color=>{
    let cell = document.createElement("div");
    cell.className = "cell " + (color==="R"?"red":"blue");
    div.appendChild(cell);
  });
}

function checkSymmetry(cols, c, r){
  let prevCol = cols[c-1];
  if(!prevCol) return "B";
  if(prevCol[r]!==undefined){
    return "R";
  } else {
    return "B";
  }
}
</script>
</body>
</html>
